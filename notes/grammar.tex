\section{Logic on posets}
\label{sec:posets}

%\subsection{Category of posets}

%% \begin{definition}[Poset]
%%   A poset $s=\{E,\leq\}$ is a finite set of events $E$ and a partial order on events $\leq\subseteq E\times E$. The \emph{cover} relation on events $\cover\subseteq E\times E$ is the transitive reduction of $\leq$.
%%   We use the predicates $\text{min}(s)$ and $\text{max}(s)$ to retrieve the minimal and maximal events, respectively.
%%   A labeled poset $s=\{E,\leq,\labl\}$ is a set with an additional labelling function $\labl$ defined on events.
%% \end{definition}

\begin{definition}[Augmented poset]
  \label{def:poset}
  An \emph{augmented poset} $s=(E,\prec,\dashv)$ is a set of events $E$ equipped with two binary relations on events: \emph{precedence} denoted $\prec$, and \emph{inhibition} denoted $\dashv$, such that the following hold:
  \begin{itemize}
  \item \emph{events are not pairwise inhibiting:}
    $\forall e_1,e_2\in s$, $e_1\dashv^{\star} e_2\implies \neg(e_2 \dashv^{\star} e_1)$;
  \item \emph{events cannot inhibit their succesors:}
    $\forall e_1,e_2\in s$, $e_1\leq e_2\implies \neg(e_1 \dashv^{\star} e_2)$;
  \end{itemize}
  where $\leq$ is the transitive and reflexive closure of $\prec$ and $\dashv^{\star}$ is the transitive and closure of $\dashv$.

  A labeled poset $s=(E,\prec,\dashv,\labl)$ is an augmented poset with an additional labelling function $\labl:E\to \textit{labels}$ defined on events.
  We use the predicates $\text{min}(s)$ and $\text{max}(s)$ to retrieve the minimal and maximal events, respectively.
  A poset is \emph{directed} when every pair of events has an upper bound.
\end{definition}

\begin{definition}[Morphisms on posets\footnote{Augmented posets and morphisms form a category.}]
  Given two posets $s_1$, $s_2$ a morphism $f:s_1\to s_2$ is a total function on events that preserves labels and preserves the precedence and inhibition relations. We denote $s_1\iso s_2$ whenever there is an isomorphism between $s_1$ and $s_2$.
%  A morphisms on posets is \emph{injective}, denoted $s_1\emb s_2$, when it is injective on events.
\end{definition}

\subsection{Grammar}

Let $\mathcal{R}$ be a set of labels, $\mathcal{S}$ be a set of posets and let $\varepsilon = \cup_{s_i\in S} E_i$ be the set of events in $\mathcal{S}$, where $E_i$ is the set of events in $s_i$.
We denote $A,B$ elements of $\mathcal{R}$ and $s$ elements of $\mathcal{S}$.

\begin{align*}
  x ::= & x^e ~|~ x^s & \tag{variables on events and posets} \\
  t^s ::= & x^s ~|~ s ~|~ \text{min}(t^s) ~|~ \text{max}(t^s) &\tag{terms on posets} \\
  t^e ::= & x^e ~|~ e & \tag{terms on events}\\
  t ::= & t^s ~|~ t^e & \tag{terms}\\
  \\
  \varphi ::= & \exists x.\varphi(x) ~|~ \forall x.\varphi(x) ~|&\tag{quantifiers}\\
  & \neg \varphi ~|~\varphi_1 \wedge \varphi_2~|&\tag{logical connectors}\\
  & t^e\in t^s ~|~ \labl(t^e) = A ~|~ t^e_1 <_{t^s} t^e_2 ~|~ t^e_1 \tleq_{t^s} t^e_2 ~|~ t^e_1\in t^s_1 \dashv t^e_2\in t^s_2~|~ t^s_1 = t^s_2 ~|~ t^s_1\subseteq t^s_2
  & \tag{predicates}\\
\end{align*}

We define the logical connectors $\vee$, $\implies$ in the usual manner.

\subsection{Interpretation}

We interpret the logic on the domain of events and posets.

%an interpretation is the link between syntax and semantics. The functions and predicates are interpreted as their corresponding operations on events and posets.
%The predicates $s_1 = s_2$ and $s_1\subseteq s_2$ are interpreted using isomorphisms and embedings in the category of posets defined below (\autoref{sec:posets}).

%The interpretation of $s_1\cap s_2$ is the set $s_1\otimes s_2$, introduced in \autoref{def:posets_otimes}.
The predicate $\dashv$ can be seen as a predicate that relates events in different posets. Our interpretation in the restrainted case of graph rewriting systems (and in Kappa) will be that of inhibition (\autoref{def:ref_neg_infl}), as we will see in the next sections. The remaining of function and predicates used in our logic have a standard interpretation.

A \emph{valuation} for $\varphi$ is a function
$v:\text{fv}(\varphi)\to\mathcal{E}\uplus\mathcal{S}$
from the set of free variables of $\varphi$ to the set of events and posets.
%
The evaluation of $\varphi$ is defined below, where a valuation function is needed for the set of free variables of $\varphi$.
%We use two functions $\enct$ to evaluate terms and $\enc$ to evaluate formulas.
\begin{align*}
  \enc{\forall x^s.\varphi}_{v} &= T \iff\text{ for all }s\in\mathcal{S}, \enc{\varphi(s/x)}_{v} = T\\
  \enc{\exists x^s.\varphi}_{v} &= T \iff\text{ for some }s\in\mathcal{S}, \enc{\varphi(s/x)}_{v} = T\\
  \enc{\neg\varphi}_v &= \neg\enc{\varphi} \\
  \enc{\varphi_1\wedge\varphi_2}_v &= \enc{\varphi_1}_v\wedge\enc{\varphi_2}_v\\
  \enc{t^e\in t^s}_v &= T\iff\enct{t^e}_v\in\enct{t^s}_v\\
  \enc{\labl(t^e) = A}_v &= T\iff\labl(\enct{t^e}_v)=A\\
  \enc{t^e_1 <_{t^s} t^e_2} &= T\iff e_1 <_s e_2\text{ where }e_1 = \enct{t^e_1}_v,e_2 = \enct{t^e_2}_v,s = \enct{t^s}_v\\
  \enc{t^e_1 \tleq_{t^s} t^e_2} &= T\iff e_1 \tleq_s e_2\text{ where }e_1 = \enct{t^e_1}_v,e_2 = \enct{t^e_2}_v,s = \enct{t^s}_v\\
  \enc{t^e_1\in t^s_1 \dashv t^e_2\in t^s_2}_v &= T\iff e_1\in s_1 \dashv e_2\in s_2\text{ where }
  e_1 = \enct{t^e_1}_v,e_2 = \enct{t^e_2}_v,s_1 = \enct{t^s_1}_v,s_2 = \enct{t^s_2}_v\\
  \enc{t^s_1\subseteq t^s_2}_v &= T\iff\enct{t^s_1}_v\emb \enct{t^s_2}_v\\
  \\
  \enct{x}_{v} &= v(x)\\
  \enct{e}_{v} &= e\\
  \enct{s}_{v} &= s\\
  \enct{\text{min}(t^s)}_{v} &= \text{min}(\enct{t^s})\\
  \enct{\text{max}(t^s)}_{v} &= \text{max}(\enct{t^s})\\
%  \enct{t^s_1 \cup t^s_2}_{v} &= \enct{t^s_1}_v \cup \enct{t^s_2}_{v}\\
%  \enct{t^s_1 \cap t^s_2}_{v} &= \enct{t^s_1}_v \otimes \enct{t^s_2}_{v}\\
\end{align*}

A formula $\varphi$ is satisfiable if there exists $v$ such that $\enc{\varphi}_v = T$.
The denotation of $\varphi$ is the set of valuations for which $\varphi$ evaluates to true.
%We give the denotation of a formula in~\autoref{app:denote}.
