
\begin{lemma}
  Let $\theta:M_2\Rightarrow M_3\cdots M_n\Rightarrow M_{n+1}$ be a trace and let $t_1:M_1\Rightarrow M_n$ be a transition. Let $\alpha(\theta,t_1) = (E,\sqsubset,\labl)$ be its abstraction such that the following hold:
  \begin{enumerate}
  \item $\forall i, 2\leq i\leq n$, $e_1\sqsubset_{O_1} e_i\iff e_i = e_n$;
  \item $(E,\sqsubset,\labl)$ is a valid decoration, according to~\autoref{def:constr_dec};
  \end{enumerate}
Then we can rewrite $\theta$ into $\theta':M_1'\Rightarrow M_2\Rightarrow M_3\cdots M_n\Rightarrow M_{n+1}$ for which $\alpha(\theta)\iso\alpha(\theta')$ and the conditions above hold.
\end{lemma}
\begin{proof}
  We proceed by induction on the trace $M_2\Rightarrow M_3\cdots M_j\Rightarrow M_{j+1}\cdots M_n\Rightarrow M_{n+1}$.

  First we introduce some notations we will need during the proof. Let us denote $\prec$ the ordering between transitions in $\theta$.
  For an event $e_j$ we say that an event $e_i$ is a $\sqsubset$-$\prec$-successor, if it is a succesor for the $\sqsubset$ relation and the latest one in the $\prec$ ordering (that is for transitions $t_i$ and $t_j$ such that $\alpha(t_i)=e_i$, $\alpha(t_j)=e_j$ we have that $t_i\prec t_j$).
  For a transition $t_i:M_i{\Rightarrow} M_{i+1}$, if $\alpha(t_i)=e_i$, then we write $M_i\overset{e_i}{\Rightarrow} M_{i+1}$.

  Let us consider one step of swapping: let $t_j:M_j\overset{e_j}{\Rightarrow} M_{j+1}$ and $t_1^j:P_j\overset{e_1}{\Rightarrow}M_{j+1}$ where $2\leq j\leq n-1$. %and $\alpha(t_j)=e_j$, $\alpha(t_1^j) = e_1$.
  \[
  \begin{tikzpicture} %[scale=0.8]
    \node (m2) at (0,1) {\(M_2\)};
    \node (dots) at (2,1) {\(\cdots\)};
    \node (mj) at (4,1) {\(M_j\)};
    \node (mj1) at (6,1) {\(M_{j+1}\)};
    \node (dots2) at (8,1) {\(\cdots\)};
    \node (mk) at (10,1) {\(M_n\)};
    \node (pk) at (0,0) {\(P_n\)};
    \node (pkj1) at (2,0) {\(P_{n-j-1}\)};
    \node (pkj) at (4,0) {\(P_{n-j}\)};
    \node (p1) at (8,0) {\(P_{1}=M_1\)};
    \draw [vecArrow] (m2) -- (dots);
    \draw [vecArrow] (dots) -- (mj);
    \draw [vecArrow] (mj) -- (mj1);
    \draw [vecArrow] (mj1) -- (dots2);
    \draw [vecArrow] (dots2) -- (mk);
    \draw [vecArrow] (pk) -- (dots);
    \draw [vecArrow] (pkj1) -- (mj);
    \draw [vecArrow] (pkj) -- (mj1);
    \draw [vecArrow] (p1) -- (mk);
  \end{tikzpicture}
  \]
  We can rewrite the transitions $M_j\overset{e_j}{\Rightarrow} M_{j+1}\overset{e_1^{-1}}{\Rightarrow} P_{n-j}$, as productions are reversible. We distinguish between two cases. In the diagram below:
    \[
    \begin{tikzpicture} %[scale=0.8]
    \node (r1) at (1.5,0) {\(R_j\)};
    \node (m1) at (2,1.5) {\(M_{j+1}\)};
    \node (l2) at (2.5,0) {\(L_1\)};
    \node (d1) at (0,1.5) {\(D_j\)};
    \node (k1) at (0,0) {\(K_j\)};
    \node (d2) at (4,1.5) {\(D_j'\)};
    \node (k2) at (4,0) {\(K_1\)};
    \node (o) at (2,-1) {\(O\)};
    \node (p) at (1,-2) {\(P\)};
    \draw [->] (k1) -- (r1);
    \draw [->] (k2) -- (l2);
    \draw [->] (k1) -- node [left,midway] {\(k_j\)} (d1);
    \draw [->] (k2) -- (d2);
    \draw [->] (d1) -- node [above,midway] {\(g_j\)} (m1);
    \draw [->] (d2) -- (m1);
    \draw [->] (l2) -- node [right,midway] {\(m_1\)} (m1);
    \draw [->] (r1) -- node [left,midway] {\(m_j\)} (m1);
    \draw [dotted,->] (l2) -- (d1);
    \draw [->] (p) -- (k1);
    \draw [->] (p) -- (o);
    \draw [->] (o) -- node [left,midway] {$o_j$} (r1);
    \draw [->] (o) -- node [right,midway] {$o_1$} (l2);
    \end{tikzpicture}
    \]
    first suppose that there is a morphism $R_1\to D_j$ such that the diagram commutes. Then we can rewrite $M_j$ using the production of $e_1^{-1}$ and obtain the transition $M_j\overset{e_1^{-1}}{\Rightarrow}P_{j+1}$. We reverse it again and obtain $P_{j+1}\overset{e_1}{\Rightarrow} M_j$. Then the induction continues with the transitions $M_{j-1}\overset{e_{j-1}}{\Rightarrow} M_{j}$ and $P_{j+1}\overset{e_1}{\Rightarrow} M_j$.

    The second case is when there is no such morphism.
    We consider the following cases:

    \begin{itemize}
    \item {\bf both events have a common $\sqsubset$-$\prec$-successor}. Note that from the first condition in the hypothesis, this case is only possible if $e_j\sqsubset e_n$. As $e_n$ is the $\sqsubset$-$\prec$-successor of $e_j$ we have that for all events $e_i$ such that $\alpha(t_i)=e_i$ and $j<i<k$, $e_j$ and $e_i$ are sequential independent.
      \begin{mdframed}[backgroundcolor=blue!20]
        not if we consider inhibition!
      \end{mdframed}
      Therefore can rewrite the trace $M_j{\Rightarrow} M_{j+1}\cdots M_n\Rightarrow M_{n+1}$ such that $M_j'\overset{e_j}{\Rightarrow}M_n\overset{e_n}{\Rightarrow}M_{n+1}$.
      The diagram above becomes then
    \[
    \begin{tikzpicture} %[scale=0.8]
    \node (r1) at (1.5,0) {\(R_j\)};
    \node (m1) at (2,1.5) {\(M_{n}\)};
    \node (l2) at (2.5,0) {\(L_1\)};
    \node (d1) at (0,1.5) {\(D_j\)};
    \node (k1) at (0,0) {\(K_j\)};
    \node (d2) at (4,1.5) {\(D_n\)};
    \node (k2) at (4,0) {\(K_1\)};
    \node (o) at (2,-1) {\(O\)};
    \node (p) at (1,-2) {\(P\)};
    \draw [->] (k1) -- (r1);
    \draw [->] (k2) -- (l2);
    \draw [->] (k1) -- node [left,midway] {\(k_j\)} (d1);
    \draw [->] (k2) -- (d2);
    \draw [->] (d1) -- node [above,midway] {\(g_j\)} (m1);
    \draw [->] (d2) -- (m1);
    \draw [->] (l2) -- node [right,midway] {\(m_1\)} (m1);
    \draw [->] (r1) -- node [left,midway] {\(m_j\)} (m1);
    \draw [->] (p) -- (k1);
    \draw [->] (p) -- (o);
    \draw [->] (o) -- node [left,midway] {$o_j$} (r1);
    \draw [->] (o) -- node [right,midway] {$o_1$} (l2);
    \end{tikzpicture}
    \]

    We have that for the transitions $M_j'\overset{e_j}{\Rightarrow}M_n\overset{e_n}{\Rightarrow}M_{n+1}$ that the underlying positive influence is $e_j\redl{+}_{O_j} e_n$ and similarly for $e_1\redl{+}_{O_1}e_n$. We obtain the following diagram
    \[
    \begin{tikzpicture} %[scale=0.8]
    \node (mn) at (0,2.5) {\(M_{n}\)};
    \node (ln) at (0,0) {\(L_{n}\)};
    \node (o) at (0,-2) {\(O\)};
    \node (oj) at (-1,-1) {\(O_j\)};
    \node (o1) at (1,-1) {\(O_1\)};
    \node (rj) at (-2,0) {\(R_j\)};
    \node (r1) at (2,0) {\(R_1\)};
    \node (d1) at (-1,1) {\(\cdot\)};
    \node (d2) at (1,1) {\(\cdot\)};
    \draw [->] (o) -- (o1);
    \draw [->] (o) -- (oj);
    \draw [->] (oj) -- (rj);
    \draw [->] (oj) -- (ln);
    \draw [->] (o1) -- (r1);
    \draw [->] (o1) -- (ln);
    \draw [->] (rj) -- (d1);
    \draw [->] (ln) -- (d1);
    \draw [->] (r1) -- (d2);
    \draw [->] (ln) -- (d2);
    \draw [dotted,->] (d1) -- (mn);
    \draw [dotted,->] (d2) -- (mn);
    \draw [->] (o) to [bend right] (r1);
    \draw [->] (o) to [bend left] (rj);
    \draw [->] (r1) to [bend right] (mn);
    \draw [->] (rj) to [bend left] (mn);
    \end{tikzpicture}
    \]
    where $O\emb O_j$ and $O\emb O_1$. This contradicts the constraints of~\autoref{def:constr_dec}.


    \item {\bf events have different $\sqsubset$-$\prec$-successors}. Let $e_i$ be the succesor of $e_j$, $e_j\sqsubset e_i$ with $i\neq k$.
      We will show that this case is not possible. %To do this we have to reason by induction on the trace

      If there is no morphism $j$ then there exists $O$ the pullback of $R_j\lemb M_{j+1}\remb L_1$ and $P$ the pullback of $K_j\lemb R_j\remb O$ such that the morphism $P\to O$ is not an iso.

    Let us suppose that
    \begin{align}
      \label{eq:ekei}
      e_k\prec e_i.
    \end{align}
    The other case is similar. We will show that $e_j\sqsubset e_k$, which would contradict the hypothesis.

    %In order to show that $e_j\sqsubset e_k$ we have to "move back" the transitions $M_j\overset{e_j}{\Rightarrow} M_{j+1}$ and $P_{j}\overset{e_1}{\Rightarrow} M_{j+1}$ to obtain $M_j'\overset{e_j}{\Rightarrow} M_k$ and

    Let us denote $O_j\subseteq M_{j+1}$ the image of $o_1(m_1(O))$ and $o_j(m_j(O))$.
    We have the transition $M_{j+1}\overset{e_{j+1}}{\Rightarrow} M_{j+2}$ and either $O_j\subseteq M_{j+2}$ or not (here we suppose, for simplifying the notations, that the morphisms $g_{j+1}$ and $f_{j+1}$ are the identity morphisms restricted to their domain of application). In the latter case, we deduce that $e_j\redl{+}_{O_j} e_{j+1}$ which leads to a contradiction on the variant of the construction $\bp$. Therefore $O_j\subseteq M_{j+2}$ and by induction on the trace $M_{j+1}\Rightarrow \cdots \Rightarrow M_k$ we have that $O_j\subseteq M_k$. Therefore
    \begin{align}
      \label{eq:e1ek}
      O_j\subseteq M_k\text{ and }e_1\sqsubset_{O_1} e_k\text{ implies that }O\emb O_1.
    \end{align}

    We have the trace $M_j\overset{e_j}{\Rightarrow} M_{j+1}\cdots M_k$ and from~\autoref{eq:ekei}, $e_j$ is not a cause for any event between $e_{j+1}$ and $e_k$, including. From the invariant of the construction $\bp$, we can "move" event $e_j$ just before the transition $M_k\overset{e_k}{\Rightarrow} M_{k+1}$ and obtain the transition $M_{j}'\overset{e_j}{\Rightarrow} M_k$.





  \end{itemize}

\end{proof}

\begin{lemma}
  \label{lemm:linear_to_trace}
  Let $s=(E,\leq,\labl)$ be a directed poset, with $s^{\star}\in\decor(s)$ one of its decorations and with $\underline{s^{\star}}\in\linear(s^{\star})$ a linear extension of $s^{\star}$. Moreover, let $(E,\leq,\labl,\fp)$ the refinement of $s^{\star}$.

  There is a function, denoted $\bp$, that converts $\underline{s^{\star}}$ into a trace such that
  \[
  \forall \theta\in \Theta, \exists \theta'\in\bp(\linear(\decor(\alpha(\Theta))))\text{ s.t. } \theta'\text{ embeds in }\theta.
  \]
\end{lemma}
\begin{proof}

  Let us first define the function $\bp$, called the \emph{backward propagator}, by induction on the reverse order in $\underline{s^{\star}}$.
  If $e_1\in\text{max}(\underline{s^{\star}})$, then $\bp(e_1) = \fp(e_1)$.
  Otherwise, for $e_1\in\underline{s^{\star}}$, we have that $e_1\prec e_2\prec\cdots e_n$ and $e_2,.., e_n$ are the events for which $\bp$ is defined so far.

  Let $e_2,e_k\in\underline{s^{\star}}$ be two events such that
  \begin{align}
    &e_1\prec e_2\text{ and there is no }e_2'\text{ with } e_1\prec e_2'\prec e_2\\
    \label{eq:e3}
    &e_1\sqsubset_O e_k\text{ and there is no }e_k'\neq e_k\text{ with } e_1\preceq e_k'\preceq e_k, 2\leq k\leq n.
  \end{align}
  As both events precede $e_1$ in $\underline{s^{\star}}$, we have that
  \begin{align}
    \bp(e_2) = M_2\Rightarrow N_2 \text{ and } \bp(e_k) = M_k\Rightarrow N_k.
  \end{align}
  Also, from the properties of refinement (\autoref{def:ref_poset}), we have that there exists a morphism $h$ such that
  \begin{align}
    \label{eq:matching}
    \fp(e_k)=M_k'\Rightarrow N_k', \fp(e_1)=M_1'\Rightarrow N_1'\text{ and }h:(M_k'\emb M_k)\circ(N_1'\emb M_k').
  \end{align}
  Next, we apply a DPO rewriting step to $M_k$ using the production $(M_1'\Rightarrow N_1')^{-1}$ and the matching $h$:
  \[
  \begin{tikzpicture} %[scale=0.8]
    \node (p1) at (0,1) {\(P_1\)};
    \node (m3) at (2,1) {\(M_k\)};
    \node (m1) at (0,0) {\(M_1\)};
    \node (n1) at (2,0) {\(N_1\)};
    \draw [->] (m1) -- (p1);
    \draw [->] (n1) -- (m3);
    \draw [vecArrow] (m3) -- (p1);
    \draw [vecArrow] (n1) -- (m1);
  \end{tikzpicture}
  \]
  \begin{mdframed}[backgroundcolor=blue!20]
    We have to show in the construction above that matching $h$ defined in~\autoref{eq:matching} allows the dpo rewriting step of $M_k$, that is that the gluing conditions hold.
  \end{mdframed}

  So far, we have a trace $M_2\Rightarrow N_2\cdots M_k\Rightarrow N_2\cdots M_n\Rightarrow N_n$ corresponding to the chain $e_2\prec e'\cdots e_k\prec e''\prec\cdots e_n$ and a transition $P_1\Rightarrow M_k$. The last step consists in "swaping" the transition $P_1\Rightarrow M_k$ at the beginning of the trace, to obtain a trace $M_1\Rightarrow M_2\Rightarrow N_2\cdots M_n\Rightarrow N_n$.

  %% We proceed by induction on the trace $M_2\Rightarrow N_2\cdots M_k\Rightarrow N_2\cdots M_n\Rightarrow N_n$.
  %% Let us consider one step of swapping: let $M_j\overset{e_j}{\Rightarrow} M_{j+1}$ and $P_j\overset{e_1}{\Rightarrow}M_{j+1}$ where $2\leq j\leq k-1$.
  %% \[
  %% \begin{tikzpicture} %[scale=0.8]
  %%   \node (m2) at (0,1) {\(M_2\)};
  %%   \node (dots) at (2,1) {\(\cdots\)};
  %%   \node (mj) at (4,1) {\(M_j\)};
  %%   \node (mj1) at (6,1) {\(M_{j+1}\)};
  %%   \node (dots2) at (8,1) {\(\cdots\)};
  %%   \node (mk) at (10,1) {\(M_k\)};
  %%   \node (pk) at (0,0) {\(P_k\)};
  %%   \node (pkj1) at (2,0) {\(P_{k-j-1}\)};
  %%   \node (pkj) at (4,0) {\(P_{k-j}\)};
  %%   \node (p1) at (8,0) {\(P_{1}\)};
  %%   \draw [vecArrow] (m2) -- (dots);
  %%   \draw [vecArrow] (dots) -- (mj);
  %%   \draw [vecArrow] (mj) -- (mj1);
  %%   \draw [vecArrow] (mj1) -- (dots2);
  %%   \draw [vecArrow] (dots2) -- (mk);
  %%   \draw [vecArrow] (pk) -- (dots);
  %%   \draw [vecArrow] (pkj1) -- (mj);
  %%   \draw [vecArrow] (pkj) -- (mj1);
  %%   \draw [vecArrow] (p1) -- (mk);
  %% \end{tikzpicture}
  %% \]

  The construction of~\autoref{lemm:linear_to_trace} is minimal w.r.t. the choice of decoration and linear extension, in the sense that each graph in the construction is the result of a pushout.

\end{proof}




\newpage

\begin{lemma}[Refinement of a poset for trace reconstruction]
  \label{lem:rewrite_concurrent}
  Let $s=(E,\tleq,\labl)$ be a poset and
  %let $(E,\sqsubset,\labl)\in \decor(s)$ be a decoration of $s$ and
  let $(E,\sqsubset,\labl,\fp)$ be a refinement of $s$.

  Let $e_1,e_2\in E$ be two incomparable events such that
  $\fp(e_1) = M_1\overset{m_1,p_1}{\Rightarrow} M_1'$ and $\fp(e_2) = M_2\overset{m_2,p_2}{\Rightarrow} M_2'$.

  We have the following additional contraint on the refinement of $s$:
  \begin{enumerate}
  \item if the two productions are co-initial, i.e. $M_1\iso M_2$ then there exists $M'$ such that the diagram commutes
  \[
  \begin{tikzpicture} %[scale=0.8]
    \node (m2) at (0,0) {\(M_2\)};
    \node (m1) at (0,1) {\(M_1\)};
    \node (m) at (-2,1) {\(M\)};
    \node (implies) at (2,1) {\(\implies\)};
    \node (mm2) at (4.5,0) {\(M_2\)};
    \node (mm1) at (4.5,1) {\(M_1\)};
    \node (n) at (6,1) {\(M'\)};
    \node (mm) at (3,1) {\(M\)};
    \draw [->] (m) -- node [left,above] {\(e_1\)} (m1);
    \draw [->] (m) -- node [left,below] {\(e_2\)} (m2);
    \draw [->] (mm) -- node [left,above] {\(e_1\)} (mm1);
    \draw [->] (mm) -- node [left,below] {\(e_2\)} (mm2);
    \draw [->] (mm1) -- node [left,above] {\(e_2'\)} (n);
    \draw [->] (mm2) -- node [left,below] {\(e_1'\)} (n);
  \end{tikzpicture}
  \]
  Moreover, for any graph $M''$ such that $M''\emb M_1$ then $M''\emb M'$.
  \item if the two productions are co-final, i.e. $M_1'\iso M_2'$ then there exists $M'$ such that the diagram commutes
  \[
  \begin{tikzpicture} %[scale=0.8]
    \node (m2) at (-2,0) {\(M_2\)};
    \node (m1) at (-2,1) {\(M_1\)};
    \node (m) at (0,1) {\(M\)};
    \node (implies) at (2,1) {\(\implies\)};
    \node (mm2) at (4.5,0) {\(M_2\)};
    \node (mm1) at (4.5,1) {\(M_1\)};
    \node (n) at (3,1) {\(M'\)};
    \node (mm) at (6,1) {\(M\)};
    \draw [->] (m1) -- node [left,above] {\(e_1\)} (m);
    \draw [->] (m2) -- node [left,below] {\(e_2\)} (m);
    \draw [->] (mm1) -- node [left,above] {\(e_1\)} (mm);
    \draw [->] (mm2) -- node [left,below] {\(e_2\)} (mm);
    \draw [->] (n) -- node [left,above] {\(e_2'\)} (mm1);
    \draw [->] (n) -- node [left,below] {\(e_1'\)} (mm2);
  \end{tikzpicture}
  \]
  Moreover, for any graph $M''$ such that $M''\emb M_1$ then $M''\emb M'$.
  \end{enumerate}
\end{lemma}
\begin{proof}
  \begin{enumerate}
  \item Let $\labl(e_1)=L_1\action R_1$ and $\labl(e_2)=L_2\action R_2$ be the labels of the two events.
    Then there exists an event $e_3$ such that $e_3\subseteq_{O_1} e_1$ and $e_3\subseteq_{O_2} e_2$. We can assume without loss of generality, that $e_3$ is the only such event (in the cover relation with $e_1$ and $e_2$). Let us show that we can rewrite $M_1'$ using rule $\labl(e_2)$ and obtain $M'$ such that $M_1\overset{e_1}{\Rightarrow} M_1'$ and $M_1'\overset{e_2'}{\Rightarrow} M_2'$ are sequentially independent.
     Let us consider only the poset restricted to events $\{e_1,e_2,e_3\}$. We have that, in the following diagram, there exists a morphism $L_2\to D'$ that commutes.
     \[
     \begin{tikzpicture} %[scale=0.8]
       \node (k1) at (0,0) {\(K_1\)};
       \node (l1) at (1.5,0) {\(L_1\)};
       \node (r3) at (2.5,0) {\(R_3\)};
       \node (l2) at (3.5,0) {\(L_2\)};
       \node (m1) at (2,1) {\(M_1'\)};
       \node (m2) at (3,1) {\(M_2'\)};
       \node (d1) at (0.5,1) {\(D_1\)};
       \node (d1p) at (1,2) {\(D_1'\)};
       \node (m1p) at (2.5,2) {\(M'\)};
       \node (d) at (1,3) {\(D\)};
       \node (m) at (2.5,3) {\(M\)};
       \draw [->] (k1) -- (l1);
       \draw [->] (k1) -- (d1);
       \draw [->] (d1) -- (d1p);
       \draw [->] (d1) -- (m1);
       \draw [->] (d1p) -- (d);
       \draw [->] (d1p) -- (m1p);
       \draw [->] (d) -- (m);
       \draw [->] (l1) -- (m1);
       \draw [->] (r3) -- (m1);
       \draw [->] (r3) -- (m2);
       \draw [->] (l2) -- (m2);
       \draw [->] (m2) -- (m1p);
       \draw [->] (m1) -- (m1p);
       \draw [->] (m1p) -- (m);
       \draw [dotted,->] (l2) -- (d1p);
     \end{tikzpicture}
     \]

     Using the corollar of~\autoref{lem:subposet} if there is no such morphism then events are sequential dependent in the original trace. From~\autoref{def:abstraction}, one has that $e_1 < e_2$, which contradicts the hypothesis.

     If there exists a morphism $L_2\to D'$ that commutes then, using~\autoref{lem:subposet} there is a morphism from $L_2\to D$ that commutes.
     Lastly we use~\autoref{church_rosser} which from such a morphism, infers that $M\overset{e_1}{\Rightarrow} M_1'$ and $M\overset{e_2}{\Rightarrow} M_2'$ are parallel independent.

  \item As we are using DPO rewriting, this case is similar to the first.
  \end{enumerate}
\end{proof}


\begin{definition}[Concretisation of a poset]
  \label{def:concretisation}
  Given a set of posets $\mathcal{S}$ let us define the concretisation function $\gamma:\mathcal{S}\subseteq\Theta$ that sends a poset to a set of traces.
  \begin{itemize}
  \item For $s\in\mathcal{S}$, let $\overline{s}\in\decor(s)$ be a decorated poset.
    We define the refinement of a decorated poset $\mathit{refine}(\overline{s}) = \{E,\sqsubset,\labl,\bp\}$, where $\overline{s} = \{E,\sqsubset,\labl\}$.
  \item For every pair of concurrent events in $\mathit{refine}(\overline{s})$ close out the diagram using~\autoref{lem:rewrite_concurrent}. Denote $S$ a diagram that is closed with respect to the concurrent events. Then define $\gamma$, the concretisation function, as a set of traces, where each trace is a path in the diagram $S$:
    \[
    \gamma(s) = \{ t : t\text{ is a path in }S\text{ and }S\text{ is one the closed diagrams of }\mathit{refine}(\decor(s))\}.
    \]
  \end{itemize}
\end{definition}

\begin{example}
  We complete the refined poset of the left by applying~\autoref{lem:rewrite_concurrent} to obtain the diagram on the right:
  \[
  \begin{tikzpicture} %[scale=0.8]
  \node (n2) at (-1,1) {\(\circ\)};
  \node (m2) at (0,0) {\(\circ\)};
  \node (m1) at (0,1) {\(\circ\)};
  \node (n) at (1,1) {\(\circ\)};
  \node (implies) at (2,1) {\(\leadsto\)};
  \node (mm2) at (5.6,0) {\(\circ\)};
  \node (mm1) at (5.6,1) {\(\circ\)};
  \node (nn) at (6.9,1) {\(\circ\)};
  \node (mm) at (4.3,0) {\(\circ\)};
  \node (nn1) at (3,0) {\(\circ\)};
  \node (nn2) at (4.3,1) {\(\circ\)};
  \node (text) at (0.8,0.4) {\(e_3\)};
  \node (text1) at (5.3,0.5) {\(e_3'\)};
  \draw [->] (n2) -- node [left,above] {\(e_1\)} (m1);
  \draw [->] (m1) -- node [left,above] {\(e_2\)} (n);
  \draw [->] (m2) -- (n);
  \draw [->] (nn2) -- node [left,above] {\(e_1\)} (mm1);
  \draw [->] (mm1) -- node [left,above] {\(e_2\)} (nn);
  \draw [->] (mm2) -- node [left,below] {\(e_3\)} (nn);
  \draw [->] (mm) -- node [left,below] {\(e_2'\)} (mm2);
  \draw [->] (mm) -- (mm1);
  \draw [->] (nn1) -- node [above] {\(e_3''\)} (nn2);
  \draw [->] (nn1) -- node [left,below] {\(e_1'\)} (mm);
\end{tikzpicture}
\]
\end{example}


\begin{theorem}
\label{th:correction}
  $\theta\subseteq \gamma(\alpha(\theta))$.
\end{theorem}
\begin{proof}
    \begin{mdframed}[backgroundcolor=blue!20]
    to do
  \end{mdframed}
\end{proof}

\begin{remark}[Adding inhibition]
  We can change definition~\autoref{def:abstraction} in order to construct posets with the additional relation of inhibition between events:
  \[
  e_i \dashv e_j \iff t_i \dashv t_j \text{ and } \alpha(t_i)=e_i, \alpha(t_j)=e_j
  \]
  Inhibition doesn't change the decoration and refinement of a poset but can make the concretisation function "more precise". In~\autoref{def:concretisation} we have to additionally remove any path in $\gamma(\alpha(\theta))$ that has two events $e_1$ followed by $e_2$ such that $e_1\dashv e_2$.
\end{remark}
