\subsection{Influence}

Let us now define the notions of influence between rules, that allows us to overapproximate the relations of causality and inhibition between events.

\begin{definition}[Multisum in the subcategory of monos]
  Let $G_1$ and $G_2$ be two graphs. The \emph{multisums} of $G_1$ and $G_2$ is a family of cospans of monos $G_1\lemb M_i\remb G_2$ such that for any other cospan of monos $G_1\lemb M'\remb G_2$ there exists a unique $M_k$, $k\leq n$ and a unique mono $M_k\lemb M'$:
  \[
  \begin{tikzpicture} %[scale=0.8]
    \node (l1) at (-1.5,0) {\(G_1\)};
    \node (l2) at (1.5,0) {\(G_2\)};
    \node (m1) at (-1,1) {\(M_1\)};
    \node (m2) at (0,1) {\(\cdots\)};
    \node (mn) at (1,1) {\(M_n\)};
    \node (n) at (0,2.5) {\(M'\)};
    \draw [right hook->] (l1) -- (m1);
    \draw [left hook->] (l2) -- (m1);
    \draw [right hook->] (l1) -- (mn);
    \draw [left hook->] (l2) -- (mn);
    \draw [right hook->] (l1) to [bend left] (n);
    \draw [left hook->] (l2) to [bend right] (n);
    \draw [left hook->, dotted] (m1) -- (n);
  \end{tikzpicture}
  \]
\end{definition}

\begin{remark}
  In using monos in the definition above, we define a family of cospans instead of defining the sum or disjoint union of $G_1$ and $G_2$.
\end{remark}

\begin{definition}[Pullback]
  The \emph{pullback} of the cospan $G_1\rightarrow M\leftarrow G_2$ is the span $G_1\leftarrow O\rightarrow G_2$ such that the following diagram commutes
  \[
  \begin{tikzpicture} %[scale=0.8]
    \node (o) at (0,-1) {\(O\)};
    \node (l1) at (-1,0) {\(G_1\)};
    \node (l2) at (1,0) {\(G_2\)};
    \node (m) at (0,1) {\(M\)};
    \draw [->] (o) --  (l1);
    \draw [->] (o) --  (l2);
    \draw [->] (l1) --  (m);
    \draw [->] (l2) --  (m);
  \end{tikzpicture}
  \]
  and such that for any other span $G_1\leftarrow O'\rightarrow G_2$ for which the diagram commutes, there is a unique morphism $O'\to O$:
  \[
  \begin{tikzpicture} %[scale=0.8]
    \node (o) at (0,-1) {\(O\)};
    \node (l1) at (-1.5,0) {\(G_1\)};
    \node (l2) at (1.5,0) {\(G_2\)};
    \node (m) at (0,1) {\(M\)};
    \node (n) at (0,-2) {\(O'\)};
    \draw [->] (o) --  (l1);
    \draw [->] (o) --  (l2);
    \draw [->] (l1) --  (m);
    \draw [->] (l2) --  (m);
    \draw [->] (n) to [bend left] (l1);
    \draw [->] (n) to [bend right] (l2);
    \draw [->, dotted] (n) -- (o);
  \end{tikzpicture}
  \]
\end{definition}

\begin{property}
  \begin{itemize}
  \item The pullback is unique up to isomorphism.
  \item The pullback preserves monos: if $G_i\to M$ is a mono then $O\to G_i$ is also a mono.
  \end{itemize}
\end{property}

\begin{definition}[Positive influence]
  \label{def:low_res}
  Let $L_1{\remb} D_1 {\lemb} R_1$ and $L_2{\remb} D_2 {\lemb} R_2$ be two rules.

  Let the cospan $R_1\lemb M\remb L_2$ be in the multisum of $R_1$ and $L_2$, from which we get the span $R_1\leftarrow O\rightarrow L_2$ as pullback.

  There is a \emph{positive influence} between the two rules induced by $O$ and denoted $r_1\redl{+}_o r_2$ if the pullback of the cospan $D_1\lemb R_1\remb O$, denoted $P$, and $O$ is not an iso. In other words, $O$ is not contained in $P$.
  \[
  \begin{tikzpicture} %[scale=0.8]
    \node (p) at (0,-1) {\(P\)};
    \node (d1) at (-1,0) {\(D_1\)};
    \node (o) at (1,0) {\(O\)};
    \node (m) at (1,2) {\(M\)};
    \node (r1) at (0,1) {\(R_1\)};
    \node (l1) at (-2,1) {\(L_1\)};
    \node (l2) at (2,1) {\(L_2\)};
    \draw [right hook->] (p) -- (d1);
    \draw [left hook->] (p) -- node [right,midway] {$\not\iso$}  (o);
    \draw [right hook->] (d1) -- (r1);
    \draw [right hook->] (d1) -- (l1);
    \draw [left hook->] (o) -- (r1);
    \draw [left hook->] (o) -- (l2);
    \draw [left hook->] (r1) --  (m);
    \draw [left hook->] (l2) --  (m);
  \end{tikzpicture}
  \]

  Define $r_1\redl{+} r_2$ if there exists $O$ such that $r_1\redl{+}_o r_2$.
\end{definition}

Similarly, define the negative influence $r_1\redl{-}_O r_2$ if there exists the span $L_1{\remb} O {\lemb} L_2$ and there is no iso between the pullback of the cospan $D_1\lemb L_1\remb O$ and $O$.

\begin{definition}[Causal pair]
  \label{def:causal_pair}
  Let $p_1:L_1{\remb} D_1 {\lemb} R_1$ and $p_2:L_2{\remb} D_2 {\lemb} R_2$ be two rules.

  A pair $P_1\overset{m_1,p_1}{\Rightarrow} M\overset{m_2,p_2}{\Rightarrow} P_2$ is a \emph{causal pair} if the cospan $R_1{\remb}M{\lemb}L_2$ is in the multisum of $R_1$ and $L_2$ and $p_1\redl{+}_O p_2$, where $O$ is the pullback of the cospan $R_1{\remb}M{\lemb}L_2$:
  \[
  \begin{tikzpicture} %[scale=0.8]
    \node (o) at (1,0) {\(O\)};
    \node (m) at (1,2) {\(M\)};
    \node (m1) at (-2,2) {\(P_1\)};
    \node (m2) at (4,2) {\(P_2\)};
    \node (r1) at (0,1) {\(R_1\)};
    \node (l1) at (-1,1) {\(L_1\)};
    \node (l2) at (2,1) {\(L_2\)};
    \node (r2) at (3,1) {\(R_2\)};
    \draw [left hook->] (o) -- (r1);
    \draw [left hook->] (o) -- (l2);
    \draw [left hook->] (r1) --  (m);
    \draw [left hook->] (l2) --  (m);
    \draw [left hook->] (l1) --  (m1);
    \draw [left hook->] (r2) --  (m2);
    \draw [>=latex, ->] (m1) -- node [above,midway] {$m_1,p_1$} (m);
    \draw [>=latex, ->] (m) -- node [above,midway] {$m_2,p_2$} (m2);
    \draw [>=latex, ->] (l2) -- (r2);
    \draw [>=latex, ->] (l1) -- (r1);
  \end{tikzpicture}
  \]
\end{definition}

\begin{lemma}
\label{lem:completeness_causal_pair}
  For each pair of sequential dependent transitions $G_1\overset{n_1,p_1}{\Rightarrow}G\overset{n_2,p_2}{\Rightarrow} G_2$ there exists a causal pair $P_1\overset{m_1,p_1}{\Rightarrow} M\overset{m_2,p_2}{\Rightarrow} P_2$ and a mono $h:M\emb G$ such that the following diagram commutes:
  \[
  \begin{tikzpicture} %[scale=0.8]
    \node (g) at (1,2.5) {\(G\)};
    \node (g1) at (-2,2.5) {\(G_1\)};
    \node (g2) at (4,2.5) {\(G_2\)};
    \node (m1) at (-2,1) {\(M_1\)};
    \node (m) at (1,1) {\(M\)};
    \node (m2) at (4,1) {\(M_2\)};
    \node (r1) at (0,-0.5) {\(R_1\)};
    \node (l1) at (-2,-0.5) {\(L_1\)};
    \node (l2) at (2,-0.5) {\(L_2\)};
    \node (r2) at (4,-0.5) {\(R_2\)};
    \draw [left hook->] (m) -- node [left,midway] {$h$} (g);
    \draw [left hook->] (m1) -- node [left,midway] {$h_1$} (g1);
    \draw [left hook->] (m2) --  (g2);
    \draw [>=latex, ->] (g1) -- node [above,midway] {$n_1,p_1$} (g);
    \draw [>=latex, ->] (g) -- node [above,midway] {$n_2,p_2$} (g2);
    \draw [>=latex, ->] (m) -- node [above,midway] {$m_2,p_2$} (m2);
    \draw [>=latex, ->] (m1) -- node [above,midway] {$m_1,p_1$}(m);
    \draw [left hook->] (r1) --  (m);
    \draw [left hook->] (l2) --  (m);
    \draw [left hook->] (l1) --  (m1);
    \draw [left hook->] (r2) --  (m2);
    \draw [>=latex, ->] (l2) -- (r2);
    \draw [>=latex, ->] (l1) -- (r1);
  \end{tikzpicture}
  \]
that is $n_1 = h_1\circ m_1$ and $n_2 = h\circ m_2$.
\end{lemma}
\begin{proof}
  First note that for any injective morphism in the diagram we can define a bijection between the domain and the image of the morphism in the codomain. For example, in the diagram above we have $m_2:L_2\to M$ an injective morphism; for any $x\in \text{image}(m_2)(L_2)$ the morphism $m_2^{-1}(x)$ is well defined.
  Secondly, we can always construct the pullback of the cospan $R_1\lemb G\remb L_2$ denoted $R_1\remb O \lemb L_2$ and the pullback of $K_1\lemb R_1\remb O$. We proceed by showing that in the diagram below
    \[
    \begin{tikzpicture} %[scale=0.8]
    \node (r1) at (1.5,0) {\(R_1\)};
    \node (m1) at (2,1.5) {\(G\)};
    \node (l2) at (2.5,0) {\(L_2\)};
    \node (d1) at (0,1.5) {\(D_1\)};
    \node (k1) at (0,0) {\(K_1\)};
    \node (d2) at (4,1.5) {\(D_2\)};
    \node (k2) at (4,0) {\(K_2\)};
    \node (o) at (2,-1) {\(O\)};
    \node (p) at (1,-2) {\(P\)};
    \draw [->] (k1) -- (r1);
    \draw [->] (k2) -- (l2);
    \draw [->] (k1) -- node [left,midway] {\(k_1\)} (d1);
    \draw [->] (k2) -- (d2);
    \draw [->] (d1) -- node [above,midway] {\(g_1\)} (m1);
    \draw [->] (d2) -- (m1);
    \draw [->] (l2) -- node [right,midway] {\(m_2\)} (m1);
    \draw [->] (r1) -- (m1);
    \draw [dotted,->] (l2) -- node [above,midway] {\(j\)} (d1);
    \draw [->] (p) -- (k1);
    \draw [->] (p) -- node [right,midway] {$\not\iso$} (o);
    \draw [->] (o) -- (r1);
    \draw [->] (o) -- node [right,midway] {$o$} (l2);
    \draw [dotted,->] (o) to [bend left] node [right,midway] {$p'$} (k1);
    \end{tikzpicture}
    \]
    if the injective morphism $P\emb O$ is an iso then we can construct an morphism $j:L_2\to D_1$ that makes the diagram commute. We will have then a contradiction from which we can infer that indeed $P\emb O$ is not an iso. The construction of the causal pair $P_1\overset{m_1,p_1}{\Rightarrow} M\overset{m_2',p_2}{\Rightarrow} P_2$ follows straightforward from it.

    Suppose that $P\emb O$ is an iso. Let us show how we can recover from that a morphism $j:L_2\to D_1$.
    Let us denote $p:P\emb O$ the isomorphism between $P$ and $O$. Furthemore, we denote $p':O\to K_1$ the composition of $p$ and $K_1\to D_1$.
    Let $o(O) =L_2'\subseteq L_2$ be the image of $o:O\to L_2$. For any $x$ (node or edge) in $L_2$, define $j(x) = k_1(p'(o^{-1}(x)))$. Consider now $x$ an edge or node in $L_2$ such that $x\notin L_2'$. We have that $m_2(x)\in G$ and moreover $m_2(x)\notin\text{image}(n_1)(R_1)$. The latter follows from $R_1 \remb O\lemb L_2$ being the pullback of $R_1\lemb G\remb L_2$. However $D_1\lemb G\remb R_1$ is the pushout of $D_1\remb K_1\lemb R_1$, hence $m_2(x)\in\text{image}(g_1)(D_1)$. $g_1$ is an injective morphism and therefore $g_1^{-1}(m_2)(x)$ is well defined. Then $j(x) = g_1^{-1}(m_2)(x)$. To summarise, $j$ is defined as follows
    \begin{align*}
      j(x) =& k_1(p'(o^{-1}(x))) &\text{for }x\in\text{image}(o)\subseteq L_2\\
      & g_1^{-1}(m_2(x))&\text{for }x\in L_2\setminus\text{image}(o).
    \end{align*}
and it is an injective morphism by construction. To show it commutes for the case when $x\in\text{image}(o)\subseteq L_2$ we use the fact that the graphs $O$ and $P$ are obtained by pullbacks.
\end{proof}

\begin{definition}[Inhibiting pair]
  Let $p_1:L_1{\remb} D_1 {\lemb} R_1$ and $p_2:L_2{\remb} D_2 {\lemb} R_2$ be two rules.

  A pair $P_1\overset{m_1,p_1}{\Leftarrow} M\overset{m_2,p_2}{\Rightarrow} P_2$ is an \emph{inhibiting pair} if the cospan $L_1{\remb}M{\lemb}L_2$ is in the multisum of $L_1$ and $L_2$ and $p_1\redl{-}_O p_2$, where $O$ is the pullback of the cospan $L_1{\remb}M{\lemb}L_2$:
  \[
  \begin{tikzpicture} %[scale=0.8]
    \node (o) at (1,0) {\(O\)};
    \node (m) at (1,2) {\(M\)};
    \node (m1) at (-2,2) {\(P_1\)};
    \node (m2) at (4,2) {\(P_2\)};
    \node (l1) at (0,1) {\(L_1\)};
    \node (r1) at (-1,1) {\(R_1\)};
    \node (l2) at (2,1) {\(L_2\)};
    \node (r2) at (3,1) {\(R_2\)};
    \draw [left hook->] (o) -- (l1);
    \draw [left hook->] (o) -- (l2);
    \draw [left hook->] (l1) --  (m);
    \draw [left hook->] (l2) --  (m);
    \draw [left hook->] (r1) --  (m1);
    \draw [left hook->] (r2) --  (m2);
    \draw [>=latex, ->] (m) -- node [above,midway] {$m_1,p_1$} (m1);
    \draw [>=latex, ->] (m) -- node [above,midway] {$m_2,p_2$} (m2);
    \draw [>=latex, ->] (l2) -- (r2);
    \draw [>=latex, ->] (l1) -- (r1);
  \end{tikzpicture}
  \]
\end{definition}

\begin{lemma}
\label{lem:completeness_inhib_pair}
  For each pair of transitions $G_1\overset{n_1,p_1}{\Leftarrow}G\overset{n_2,p_2}{\Rightarrow} G_2$, where $G\overset{n_1,p_1}{\Rightarrow}G_1$ inhibits $G\overset{n_2,p_2}{\Rightarrow} G_2$ there exists an inhibiting pair $P_1\overset{m_1,p_1}{\Leftarrow} M\overset{m_2,p_2}{\Rightarrow} P_2$ and a mono $h:M\emb G$ such that the following diagram commutes:
  \[
  \begin{tikzpicture} %[scale=0.8]
    \node (g) at (1,2.5) {\(G\)};
    \node (g1) at (-2,2.5) {\(G_1\)};
    \node (g2) at (4,2.5) {\(G_2\)};
    \node (m1) at (-2,1) {\(M_1\)};
    \node (m) at (1,1) {\(M\)};
    \node (m2) at (4,1) {\(M_2\)};
    \node (l1) at (0,-0.5) {\(R_1\)};
    \node (r1) at (-2,-0.5) {\(L_1\)};
    \node (l2) at (2,-0.5) {\(L_2\)};
    \node (r2) at (4,-0.5) {\(R_2\)};
    \draw [left hook->] (m) -- node [left,midway] {$h$} (g);
    \draw [left hook->] (m1) -- node [left,midway] {$h_1$} (g1);
    \draw [left hook->] (m2) --  (g2);
    \draw [>=latex, ->] (g) -- node [above,midway] {$n_1,p_1$} (g1);
    \draw [>=latex, ->] (g) -- node [above,midway] {$n_2,p_2$} (g2);
    \draw [>=latex, ->] (m) -- node [above,midway] {$m_2,p_2$} (m2);
    \draw [>=latex, ->] (m) -- node [above,midway] {$m_1,p_1$} (m1);
    \draw [left hook->] (l1) --  (m);
    \draw [left hook->] (l2) --  (m);
    \draw [left hook->] (r1) --  (m1);
    \draw [left hook->] (r2) --  (m2);
    \draw [>=latex, ->] (l2) -- (r2);
    \draw [>=latex, ->] (l1) -- (r1);
  \end{tikzpicture}
  \]
that is $n_1 = h\circ m_1$ and $n_2 = h\circ m_2$.
\end{lemma}
The proof is similar to the one of \autoref{lem:completeness_causal_pair}.

\begin{remark}
  \autoref{lem:completeness_inhib_pair} is a weaker version of the completness result on critical pairs \cite{AlgebraicGR}.
\end{remark}
