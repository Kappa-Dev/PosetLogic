
%% \subsection{Denotations for a formula}
%% \label{app:denote}
%% \[
%% \begin{array}{rcl}
%%   \den{x^e} &=& \{v : \{x^e\}\to \mathcal{E}\}\\
%%   \den{x^s} &=& \{v : \{x^s\}\to \mathcal{S}\}\\
%%   \den{\forall x.\varphi} &=& \{v :\fn{\varphi}\to\mathcal{E}\uplus\mathcal{S} ~\Big|~ v \in \{\varphi\}\text{ and }\enc{\forall x.\varphi}_v= T\}\\
%%   \den{\varphi_1 \wedge \varphi_2} &=& \{v: \fn{\varphi_1}\cup\fn{\varphi_2}\to\mathcal{E}\uplus\mathcal{S}~\Big|~ \\
%%   &&\begin{array}{ll}
%%   \quad v(x) = v_1(x)\wedge v(x) = v_2(x), &\text{ if }x\in\fn{\varphi_1}\cap\fn{\varphi_2}\\
%%   \quad v(x) = v_1(x) &\text{ if }x\in\fn{\varphi_1},x\notin\fn{\varphi_2}\\
%%   \quad v(x) = v_2(x) &\text{ if }x\in\fn{\varphi_2},x\notin\fn{\varphi_1}\\
%%   \end{array}\\
%%   &&\text{ and }v_i\in\den{\varphi_i}\text{ for }i=1,2\}\\
%%   \den{\neg(\varphi)} &=& \{v :\fn{\varphi}\to\mathcal{E}\uplus\mathcal{S} ~\Big|~ v(x^e) = \mathcal{E}\setminus v'(x^e)\text{ and }v(x^s) = \mathcal{S}\setminus v'(x^s)\\
%%   &&\text{ for }x^e, x^s\in \fn{\varphi}, v'\in\den{\varphi}\}
%%   \\
%%   \den{ x^e\in x^s} &=& \{v :\{x^e,x^s\}\to\mathcal{E}\uplus\mathcal{S} ~\Big|~ v(x^e)\in v(x^s) \} \\
%%   \den{ x^e\in f(t^s_1,\cdots t^s_n)} &=& \{v :\{x^e\}\cup\fn{t^s_1}\cdots\cup\fn{t^s_n}\to\mathcal{E}\uplus\mathcal{S} ~\Big|~ v(x^e)\in f(\enc{t^s_1}_v,\cdots \enc{t^s_n}_v \} \\
%%   \\
%%   \den{\text{func}(t_1,\cdots t_n)}_{v} &=& \text{func}(\den{t_1}_{v},\cdots,\den{t_n}_{v}) \\
%% \end{array}
%% \]
%% \begin{mdframed}[backgroundcolor=blue!20]
%% to do: valuation for the rest of the predicates
%% \end{mdframed}

\subsection{Rules in Kappa: the prefix convention}
\label{app:prefix_convention}

In Kappa, we write rules $L\action R$ and derive the domain of definition. For instance, for the rule
\begin{verbatim}
  A(x!1), C(y!1), B(y) -> A(x!1), C(y), B(y!1)
\end{verbatim}
we obtain the domain of definition \verb|A(x?), C(y?), B(y?)|.


\begin{definition}[Numbered site graphs]
  Let us equip a site graph $G$ with an identity function $\idf:\nodes_G\to \nat$ such that $\forall n_1, n_2\in\nodes_G$, if $\idf(n_1)=\idf(n_2)$ then $n_1 = n_2$.

  Morphisms on numbered site graphs are the morphisms on site graphs that additionally preserves the identity function on nodes.
\end{definition}

\begin{mdframed}[backgroundcolor=blue!20]
make this consistent with id graphs
\end{mdframed}


\begin{lemma}
  In the category of numbered site graphs and morphisms there exists the product between any two numbered site graphs.
\end{lemma}
\begin{proof}
  to do.
\end{proof}

Let us now consider a rule on site graphs (\autoref{def:rule_site}), such that only the LHS and the RHS are specified: $r:L\action R$. We convert the two site graphs in numbered site graphs, where the identity function is defined by the position of each node in the syntactic description of the rule. We call this the \emph{prefix convention} on rules. Then one can derive the domain of definition of the rule as the product of the LHS and the RHS.
